<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Análise Likert por Dimensão</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #0f172a; color: white; padding: 20px; }
        .container { max-width: 1000px; margin: auto; }
        .card { background: #1e293b; padding: 25px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        input { width: 70%; padding: 12px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; }
        button { padding: 12px 20px; background: #2563eb; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .chart-container { background: white; padding: 20px; border-radius: 12px; margin-top: 20px; height: 500px; }
        h2 { text-align: center; color: #60a5fa; }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h2>Frequência Likert por Dimensão</h2>
        <div style="display:flex; gap:10px; justify-content: center;">
            <input type="text" id="urlInput" placeholder="Link CSV da Planilha">
            <button onclick="carregarDados()">Gerar Gráfico</button>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="graficoLikert"></canvas>
    </div>
</div>

<script>
    let meuGrafico = null;

    // Escala: 0 (Infeliz) a 5 (Muito Feliz)
    const labelsEscala = ["0 - Infeliz", "1", "2", "3", "4", "5 - Muito Feliz"];
    const coresEscala = ["#ef4444", "#f87171", "#94a3b8", "#60a5fa", "#3b82f6", "#1d4ed8"];

    async function carregarDados() {
        const url = document.getElementById('urlInput').value;
        if (!url) return alert("Insira o link!");

        try {
            const response = await fetch(url);
            const text = await response.text();
            const linhas = text.split('\n').filter(l => l.trim() !== '').map(l => l.split(','));
            const dados = linhas.slice(1).map(l => l.map(n => parseInt(n.trim())));
            
            processarLikert(dados);
        } catch (e) {
            alert("Erro ao processar dados.");
        }
    }

    function processarLikert(dados) {
        // Mapeamento das colunas (conforme sua estrutura)
        const dimensoes = [
            { nome: "Dimensão 1", cols: [2, 3, 4, 5, 6, 7] },
            { nome: "Dimensão 2", cols: [8, 9, 10, 11, 12] },
            { nome: "Dimensão 3", cols: [13, 14, 15, 16, 17] }
        ];

        // Preparar datasets para o Chart.js (um dataset para cada nível da escala 0-5)
        const datasets = labelsEscala.map((label, i) => ({
            label: label,
            data: [],
            backgroundColor: coresEscala[i]
        }));

        dimensoes.forEach(dim => {
            const contagem = [0, 0, 0, 0, 0, 0]; // para níveis 0,1,2,3,4,5
            let totalRespostas = 0;

            dados.forEach(row => {
                dim.cols.forEach(colIdx => {
                    const valor = row[colIdx];
                    if (!isNaN(valor) && valor >= 0 && valor <= 5) {
                        contagem[valor]++;
                        totalRespostas++;
                    }
                });
            });

            // Converter para percentual para facilitar a comparação entre dimensões
            contagem.forEach((qtd, i) => {
                const percentual = ((qtd / totalRespostas) * 100).toFixed(1);
                datasets[i].data.push(percentual);
            });
        });

        renderizar(dimensoes.map(d => d.nome), datasets);
    }

    function renderizar(labelsDimensoes, datasets) {
        const ctx = document.getElementById('graficoLikert').getContext('2d');
        if (meuGrafico) meuGrafico.destroy();

        meuGrafico = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labelsDimensoes,
                datasets: datasets
            },
            options: {
                indexAxis: 'y', // Barras horizontais para melhor leitura
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { color: '#334155' } },
                    title: { display: true, text: 'Distribuição de Sentimento (%) por Dimensão', font: {size: 18} }
                },
                scales: {
                    x: { stacked: true, max: 100, title: { display: true, text: 'Percentual (%)' } },
                    y: { stacked: true }
                }
            }
        });
    }
</script>

</body>
</html>
